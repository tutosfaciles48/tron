function Explosion(e){this.pos=e,this.duration=Math.ceil(20*Math.random()+5),this.speed=10*Math.random(),this.color=COLORS.light,this.particles=[];for(var t=0;10>t;t++)this.particles.push({opac:1,x:e.x,y:e.y,dx:Math.random()*this.speed-this.speed/2,dy:Math.random()*this.speed-this.speed/2})}DIRECTIONS={N:38,E:39,S:40,W:37},COLORS={light:"#0D9FB6",red:"#F7532E",bg:"#002634"},Tron=new function(){var e,t,s,i,o=window.innerWidth,n=window.innerHeight,r=700,c=500,p=(n-c)/2,a=(o-r)/2,l=5,d=[];this.build=function(){ctx=document.getElementById("main"),t=ctx.getContext("2d"),e=new Pen(t,r,c),$("#main").css({top:p,left:a}),ctx.height=c,ctx.width=r},this.run=function(){i.alive&&(s.setAt(i.prepos.x,i.prepos.y,1),i.move()),i.alive&&(!s.inBounds(i.curpos.x,i.curpos.y)||s.getAt(i.curpos.x,i.curpos.y)>0)&&(socket.send("Player has Died"),i.alive=!1,d.push(new Explosion({x:i.curpos.x*l,y:i.curpos.y*l}))),e.clear(COLORS.bg),s.map(Tron.displayItems,{});for(var t=0;t<d.length;t++){curexp=d[t],curexp.step();for(var o=0;o<curexp.particles.length;o++)curpar=curexp.particles[o],e.rect(curpar.x,curpar.y,3,3,curexp.color);curexp.dead()&&d.splice(t,1)}},this.keyboard=$(document).keydown(function(e){e.keyCode>=37&&e.keyCode<=40&&i.changeDir(e.keyCode)}),this.displayItems=function(t,s){t>0&&e.rect(s.x*l,s.y*l,l,l,"#0D9FB6")}};var socket=new io.Socket(null,{port:8e3});if(socket.connect(),handleMsg(msg),"players"in msg){Tron.players=msg.players,$("#numUsers").html(msg.players.length),$("#userList").html("");for(var i=0;i<msg.players.length;i++)$("#userList").append("<li>"+msg.players[i]+"</li>");console.log(Tron.players)}"grid"in msg&&(grid=msg.grid,console.log(grid)),socket.on("message",function(e){handleMsg(e)}),socket.on("connect",function(){}),socket.on("disconnect",function(){}),Explosion.prototype.step=function(){var e;for(e=0;e<this.particles.length;e++)this.particles[e].opac-=Math.random(),this.particles[e].x+=this.particles[e].dx,this.particles[e].y+=this.particles[e].dy;this.duration-=1},Explosion.prototype.dead=function(){return this.duration<=0},Tron.build();
